(function(){"use strict";self.onmessage=async s=>{const{file1:n,file2:g}=s.data;try{self.postMessage({type:"PROGRESS",message:"Reading source file..."});const o=(await n.text()).split(/\r?\n/);self.postMessage({type:"PROGRESS",message:"Reading target file..."});const i=(await g.text()).split(/\r?\n/),r=Math.max(o.length,i.length);let f=0;self.postMessage({type:"PROGRESS",message:"Comparing lines..."});const d=[];for(let e=0;e<r;e++){const l=e<o.length?o[e]:null,a=e<i.length?i[e]:null,p=l!==a;p&&f++;let t="same";l===null&&a!==null?t="added":l!==null&&a===null?t="removed":p&&(t="modified"),d.push({index:e,source:l!==null?{lineNumber:e+1,content:c(l,2e3),changeType:t==="added"?"added":t}:null,target:a!==null?{lineNumber:e+1,content:c(a,2e3),changeType:t==="removed"?"removed":t}:null}),e%5e4===0&&self.postMessage({type:"PROGRESS",message:`Comparing... (${Math.round(e/r*100)}%)`})}const m={totalLines:r,totalDifferences:f,sourceSize:n.size,targetSize:g.size,totalPages:1};self.postMessage({type:"COMPLETE",stats:m,processedLines:d})}catch(u){self.postMessage({type:"ERROR",error:u.message})}};function c(s,n){return s.length<=n?s:s.substring(0,n)+"... (truncated)"}})();
